<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
xmlns:ui="http://java.sun.com/jsf/facelets"
xmlns:h="http://java.sun.com/jsf/html"
xmlns:f="http://java.sun.com/jsf/core"
xmlns:p="http://primefaces.org/ui">
<f:view>
<h:head><title>Baloratu edo erreklamatu bidaiak</title>
    <link rel="stylesheet" href="css/baler.css" />
</h:head>
<h:body>

<h:form id="mainForm">

    <div class="query-container">

        <div class="top-info">
            <div class="email">
                #{queryreserve.posta}
            </div>

            <div class="money">
                <h:outputText value="#{queryreserve.tot}">
                    <f:convertNumber type="number" maxFractionDigits="2" />
                </h:outputText>â‚¬
            </div>
        </div>

        <h3>Baloratu edo erreklamatu bidaiak</h3>

        <div class="query-actions">
            <h:commandButton value="Itzuli"
                             action="#{traveler.itzuli}"
                             immediate="true"
                             styleClass="btn-secondary-link"/>
        </div>

<p:messages id="msgs" globalOnly="true"  infoClass="info" errorClass="error"  />

        <div class="status-legend">
    <span class="legend-item review">Berrikusten</span>
    <span class="legend-item ok">Onartua</span>
    <span class="legend-item reject">Baztertuta</span>
    <span class="legend-item none">Egin gabe</span>
</div>


        <p:dataTable id="taula"
                     value="#{baler.reservesList}"
                     var="er"
                     emptyMessage="Ez duzu bukatutako erreserbarik.">

            <p:column headerText="Noiz" sortBy="#{er.ride.date}">
                #{er.ride.date}
            </p:column>

            <p:column headerText="Nondik">
                #{er.ride.froma}
            </p:column>

            <p:column headerText="Nora">
                #{er.ride.toa}
            </p:column>

            <p:column headerText="Eserlekuak">
                #{er.places}
            </p:column>

            <p:column headerText="Prezioa">
                <h:outputText value="#{er.ride.price * er.places}">
                    <f:convertNumber type="number" maxFractionDigits="2" />
                </h:outputText> â‚¬
            </p:column>

            <p:column headerText="Balorazioa">
                <p:rating value="#{er.bal}"
                          stars="5"
                          cancel="false">
                    <p:ajax event="rate"
                            listener="#{baler.baloratu(er)}"/>
                </p:rating>
            </p:column>

            <p:column style="width: 180px; text-align: center;">
    <p:commandButton value="Erreklamatu"
                 styleClass="btn-rekl"
                 oncomplete="PF('reklDialog').show();"
                 actionListener="#{baler.erreklamatu(er)}"
                 update="formReklDialog"/>

</p:column>


            <p:column styleClass="status-col">
                <h:outputText value="
                    #{er.err eq 'berrikusten' ? 'ðŸŸ¦' :
                       er.err eq 'onartua' ? 'ðŸŸ©' :
                       er.err eq 'baztertuta' ? 'ðŸŸ¥' : 'â¬œ'}"/>
            </p:column>

        </p:dataTable>

    </div>
</h:form>

<p:dialog id="reklDialog"
          header="Erreklamazioa"
          widgetVar="reklDialog"
          modal="true"
          resizable="false"
          width="500">

    <h:form id="formReklDialog">

        <h:panelGrid columns="2" cellpadding="7">
            <h:outputLabel value="Arrazoia"/>
            <h:inputText value="#{baler.erTit}" required="true"/>

            <h:outputLabel value="Deskribapena"/>
            <h:inputTextarea value="#{baler.erDesk}"
                             rows="5"
                             required="true"/>
        </h:panelGrid>

        <div class="dialog-actions">
            <p:commandButton value="Bidali"
                             actionListener="#{baler.erBidali}"
                             update=":mainForm:msgs :mainForm:taula"
                             oncomplete="PF('reklDialog').hide();"/>
        </div>

    </h:form>
</p:dialog>

</h:body>

</f:view>
</html>